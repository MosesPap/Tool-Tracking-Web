<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register Tools - Tool Tracking System</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Shared CSS (we'll create this later) -->
    <link rel="stylesheet" href="css/common.css">
    
    <style>
        /* Include essential styles inline for register-tools page */
        /* Copy key styles from index.html here */
        body, html {
            margin: 0;
            padding: 0;
        }
        
        .full-width-title-bar {
            width: 100vw !important;
            margin-left: calc(50% - 50vw) !important;
            margin-right: calc(50% - 50vw) !important;
            margin-top: 0 !important;
        }
        
        /* Add other essential styles here - I'll reference the main CSS file */
    </style>
</head>
<body>
    <!-- Main App Section -->
    <div id="appSection">
        <!-- Orange Top Bar with Title -->
        <div class="full-width-title-bar" style="background: #FF9800; color: white; padding: 10px 0 8px 0; position: relative; box-shadow: 0 2px 8px rgba(255,152,0,0.10); margin-bottom: 0.5rem; overflow: visible;">
            <h2 style="margin: 0 0 0 20px; font-size: 1.3rem; font-weight: bold; letter-spacing: 1px; padding-right: 160px;">Register Tools</h2>
            <button id="backToMenuBtn" title="Back to Menu" onclick="window.location.href='menu.html'">
                <i class="fas fa-arrow-left"></i> Back to Menu
            </button>
        </div>
        
        <!-- Welcome Message -->
        <div style="margin: 8px 0 10px 0; text-align: left; display: flex; align-items: center; gap: 12px;">
            <span style="font-size: 1.5rem; color: #333; font-weight: bold;">Welcome, <span id="registerScreenName" class="technician-name"></span></span>
            <span id="onlineStatus" class="status-dot"></span>
        </div>
        
        <div id="registerToolsHeader" style="display: flex; align-items: center; justify-content: flex-start; gap: 16px; margin-bottom: 12px;">
            <span id="workLocationLabel" style="font-weight: bold; font-size: 2rem;">
                <span style="color: black;">Station:</span> 
                <span id="workLocationValue" style="color: red; font-size: 2rem;">(not selected)</span>
            </span>
            <button id="changeWorkLocationBtn" class="btn btn-outline-primary btn-sm" type="button">
                <i class="fas fa-helicopter"></i> Change Station
            </button>
        </div>

        <!-- Tab Navigation -->
        <ul class="nav nav-tabs mb-3" id="registerToolsTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="scanToolTab" data-bs-toggle="tab" data-bs-target="#scannerView" type="button" role="tab" aria-controls="scannerView" aria-selected="true">
                    <i class="fas fa-qrcode"></i> Scan Tool
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="searchToolsTab" data-bs-toggle="tab" data-bs-target="#searchToolsView" type="button" role="tab" aria-controls="searchToolsView" aria-selected="false">
                    <i class="fas fa-search"></i> Search Tools
                </button>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content">
            <!-- Scanner View -->
            <div class="tab-pane fade show active" id="scannerView" role="tabpanel">
                <div class="row">
                    <div class="col-xl-6 mx-auto">
                        <div id="scannerControlsBox" style="display: block;">
                            <div class="scanner-container" id="scannerContainer" style="position: relative;">
                                <div class="card mb-2">
                                    <div class="card-body" style="padding-bottom: 10px; padding-top: 12px; position: relative;">
                                        <div class="d-flex gap-2 mb-2" style="margin-top: 4px;">
                                            <button id="basicScannerBtn" onclick="startScanner()" class="btn btn-scan active">
                                                <i class="fas fa-qrcode"></i> Basic Scanner
                                            </button>
                                            <button id="advancedScannerBtn" onclick="startEnhancedScanner()" class="btn btn-scan">
                                                <i class="fas fa-camera"></i> Advanced Scanner
                                            </button>
                                        </div>
                                        <div id="reader" style="display:none; position: relative;">
                                            <!-- Advanced scanner controls -->
                                            <div id="advancedScannerControls" style="display: none; position: absolute; top: 10px; right: 10px; z-index: 10;">
                                                <button id="torchBtn" class="btn btn-sm" style="background: rgba(0,0,0,0.5); color: white; border: none; margin-bottom: 5px; border-radius: 50%; width: 40px; height: 40px; padding: 0;" title="Toggle Torch">
                                                    <i class="fas fa-star"></i>
                                                </button>
                                            </div>
                                            <div id="advancedScannerBottomControls" style="display: none; position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%); z-index: 10; background: rgba(0,0,0,0.5); padding: 8px; border-radius: 20px;">
                                                <button id="zoomOutBtn" class="btn btn-sm" style="background: transparent; color: white; border: 1px solid white; border-radius: 50%; width: 35px; height: 35px; padding: 0; margin-right: 10px;" title="Zoom Out">
                                                    <i class="fas fa-search-minus"></i>
                                                </button>
                                                <span id="zoomLevel" style="color: white; font-weight: bold; margin: 0 10px; min-width: 50px; display: inline-block; text-align: center;">1.0x</span>
                                                <button id="zoomInBtn" class="btn btn-sm" style="background: transparent; color: white; border: 1px solid white; border-radius: 50%; width: 35px; height: 35px; padding: 0; margin-left: 10px;" title="Zoom In">
                                                    <i class="fas fa-search-plus"></i>
                                                </button>
                                            </div>
                                            <div id="focusIndicator" style="display: none; position: absolute; width: 60px; height: 60px; border: 2px solid #4CAF50; border-radius: 50%; pointer-events: none; z-index: 15;"></div>
                                        </div>
                                        <!-- Bulk Scan Message -->
                                        <div id="bulkScanMessage" style="display: none; position: absolute; top: 60px; left: 50%; transform: translateX(-50%); z-index: 1000; padding: 12px 24px; border-radius: 8px; font-weight: bold; text-align: center; font-size: 1rem; max-width: 90%; box-shadow: 0 4px 12px rgba(0,0,0,0.5); pointer-events: none; white-space: nowrap;"></div>
                                        <div class="input-group mb-2">
                                            <input type="text" id="toolCode" class="form-control" placeholder="Scan or Type Tool Code">
                                            <button onclick="submitCode()" class="btn btn-primary submit-check-btn">
                                                <i class="fas fa-check"></i>
                                            </button>
                                        </div>
                                        <div class="d-flex gap-2 mb-2">
                                            <button id="bulkScanModeBtn" onclick="toggleBulkScanMode()" class="btn btn-sm" style="background: linear-gradient(135deg, #e0e0e0 0%, #bdbdbd 100%); border: 2px solid #bdbdbd; color: #333; border-radius: 12px; font-weight: bold; flex: 1;">
                                                <i class="fas fa-layer-group"></i> Bulk Scan Mode
                                            </button>
                                            <button id="toolDetailsBtn" class="btn btn-info" style="flex: 1;" disabled onclick="showLastScannedToolDetails()">Tool Details</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="toolList" class="mt-2">
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                                <h4 style="font-size: 1.5rem; font-weight: bold; margin: 0;">Today's Scanned Tools</h4>
                                <button id="todayAnalyticsBtn" onclick="showTodayAnalytics()" class="btn-analytics" title="View Today's Analytics">
                                    <i class="fas fa-chart-bar"></i>
                                </button>
                            </div>
                            <div id="toolsContainer">
                                <!-- Tools will be listed here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Search Tools View -->
            <div class="tab-pane fade" id="searchToolsView" role="tabpanel">
                <div class="row">
                    <div class="col-xl-6 mx-auto">
                        <div class="card mb-2">
                            <div class="card-body" style="padding-bottom: 10px; padding-top: 12px;">
                                <h4 style="font-size: 1.1rem; margin-bottom: 10px;">Search Tools</h4>
                                <div class="mb-3">
                                    <label class="form-label mb-2 d-block">Search By:</label>
                                    <div class="d-flex gap-2">
                                        <button id="searchTypeToolName" onclick="setSearchType('toolName')" class="btn search-type-btn active">
                                            Tool Name
                                        </button>
                                        <button id="searchTypePartNumber" onclick="setSearchType('partNumber')" class="btn search-type-btn">
                                            Part Number
                                        </button>
                                    </div>
                                </div>
                                <div class="mb-2 position-relative">
                                    <input type="text" id="searchToolInput" class="form-control" placeholder="Start typing to search..." onkeyup="handleSearchInputKeyup(event)" onfocus="handleSearchInputFocus()" onblur="handleSearchInputBlur()" autocomplete="off">
                                    <div id="searchDropdownList" class="search-dropdown-list" style="display: none;">
                                        <!-- Dropdown items will be populated here -->
                                    </div>
                                </div>
                                <div id="searchResultsContainer" style="display: none;">
                                    <label for="searchResultsDropdown" class="form-label mt-2">Search Results:</label>
                                    <select id="searchResultsDropdown" class="form-select" size="10" onchange="selectToolFromSearch(this.value)">
                                        <option value="">-- Select a tool --</option>
                                    </select>
                                </div>
                                <div id="selectedToolDetails" class="mt-3" style="display: none;">
                                    <!-- Selected tool details will be displayed here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Add modals here: toolDetailsModal, todayAnalyticsModal, locationSelectionModal, etc. -->
    
    <!-- Scripts -->
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage.js"></script>
    
    <!-- Html5Qrcode -->
    <script src="https://unpkg.com/html5-qrcode"></script>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Shared JS Files -->
    <script src="js/firebase-config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/navigation.js"></script>
    
    <!-- Register Tools Specific JS -->
    <script src="js/register-tools.js"></script>
    
    <script>
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Check authentication
            auth.onAuthStateChanged(function(user) {
                if (!user) {
                    window.location.href = 'index.html';
                } else {
                    // User is logged in, initialize page
                    updateLoggedInTechnician();
                    // Initialize register tools functionality
                    initializeRegisterTools();
                }
            });
        });
    </script>
</body>
</html>

